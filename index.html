<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Holodnak Impact Index (v17)</title>
<style>
  :root { --bg:#0b0d10; --fg:#eaeef2; --muted:#9aa4af; --accent:#7cc4ff; --card:#12161b; --green:#27c93f; --red:#ff5555; }
  html, body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; }
  header { padding: 20px; border-bottom: 1px solid #1e242b; }
  header h1 { margin: 0 0 6px 0; font-size: 22px; }
  header .meta { color: var(--muted); font-size: 13px; }
  main { display: grid; grid-template-columns: 1fr 360px; gap: 18px; padding: 18px; }
  @media (max-width: 980px) { main { grid-template-columns: 1fr; } #drawer { order: -1; } }
  #toolbar { display:flex; gap:10px; align-items: center; margin-bottom: 10px; }
  #search { flex:1; padding:10px 12px; border-radius: 8px; border:1px solid #27303a; background:#0f1318; color:var(--fg); }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 10px 8px; border-bottom: 1px solid #1e242b; text-align: right; font-variant-numeric: tabular-nums; }
  th:first-child, td:first-child, th:nth-child(2), td:nth-child(2) { text-align: left; }
  /* Removed sticky/frozen first column styles */
  th { position: sticky; top: 0; background: #0f1318; cursor: pointer; white-space: nowrap; }
  tr:hover { background: #0f1318; }
  .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#0f1318; border:1px solid #27303a; color:var(--muted); }
  .spark { display:inline-block; height:8px; width:100px; background:#1e242b; border-radius:4px; vertical-align:middle; margin-left:6px; }
  .spark > i { display:block; height:8px; border-radius:4px; background:linear-gradient(90deg, var(--red), var(--green)); }
  #drawer { background: var(--card); border:1px solid #1e242b; border-radius: 12px; padding: 14px; height: fit-content; position: sticky; top: 18px; }
  #drawer h2 { margin: 4px 0 12px 0; font-size: 18px; }
  #drawer .dim { margin: 8px 0 14px; }
  #drawer .dim h3 { margin: 0 0 6px; font-size: 14px; color: var(--muted); }
  #drawer .dim p { margin: 0; font-size: 14px; line-height: 1.35; color: #c9d2db; }
  .muted { color: var(--muted); font-size: 13px; }
  .hi { font-weight:600; }
  .foot { color: var(--muted); margin-top: 8px; font-size: 12px; }
</style>
</head>
<body>
<header>
  <h1>Holodnak Impact Index (v17)</h1>
  <p class="tagline">
    Measuring human influence on prosperity, democracy, science, and space.
  </p>
  <div class="meta">Weights: Prosperity 0.45 Â· Democracy 0.10 Â· Science & Tech 0.35 Â· Space 0.10</div>
</header>
<main>
  <section>
    <div id="weights-ui" style="margin-bottom:18px;display:flex;gap:18px;align-items:center;flex-wrap:wrap;">
      <span style="font-size:15px;color:var(--muted);margin-right:8px;">Adjust weights:</span>
      <label>Prosperity <input type="number" id="wP" min="0" max="1" step="0.01" style="width:60px;" value="0.45"></label>
      <label>Democracy <input type="number" id="wD" min="0" max="1" step="0.01" style="width:60px;" value="0.10"></label>
      <label>Science & Tech <input type="number" id="wS" min="0" max="1" step="0.01" style="width:60px;" value="0.35"></label>
      <label>Space <input type="number" id="wSp" min="0" max="1" step="0.01" style="width:60px;" value="0.10"></label>
      <span id="weights-warning" style="color:var(--red);font-size:13px;display:none;margin-left:12px;">Weights must sum to 1.00</span>
    </div>
    <div id="toolbar">
      <input id="search" type="search" placeholder="Search people or countriesâ€¦ (comma to compare)" aria-label="Search" title="Type multiple names or countries separated by commas to compare (e.g., Elon Musk, Karl Marx)">
      <span class="pill" id="count"></span>
    </div>
    <div style="overflow:auto; max-height:60vh; padding-right:18px;">
      <table id="hii">
        <thead>
          <tr>
            <th data-k="name">Person</th>
            <th data-k="H_dom">HII-Domestic</th>
            <th data-k="P_dom">Prosperity</th>
            <th data-k="D_dom">Democracy</th>
            <th data-k="S_dom">Science & Tech</th>
            <th data-k="Sp_dom">Space</th>
            <th data-k="H_world">HII-World</th>
            <th data-k="P_world">Prosperity</th>
            <th data-k="D_world">Democracy</th>
            <th data-k="S_world">Science & Tech</th>
            <th data-k="Sp_world">Space</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="foot">Click headers to sort. Click a row to see the rationale.</div>
    <div style="margin:24px 0 0 0; text-align:center;">
      <span style="font-size:15px; color:var(--muted);">Suggest a person to evaluate:</span>
      <span style="margin-left:8px; font-size:15px;">
        <a href="https://github.com/bayridgeboy/holodnak-impact-index/issues/new" target="_blank" style="color:var(--accent);text-decoration:underline;">Create an issue on GitHub</a>
      </span>
    </div>
  </section>
  <aside id="drawer" style="position:relative;">
    <button id="closeDrawer" title="Close" style="position:absolute;top:8px;right:8px;background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1;">&times;</button>
    <h2>Select a person</h2>
    <div class="muted">Click any row to see the per-variable rationale.</div>
    <div id="details" style="display:none;">
      <div class="muted" id="who"></div>
      <div class="dim"><h3>Prosperity</h3><p id="xP"></p></div>
      <div class="dim"><h3>Democracy</h3><p id="xD"></p></div>
      <div class="dim"><h3>Science & Tech</h3><p id="xS"></p></div>
      <div class="dim"><h3>Space</h3><p id="xSp"></p></div>
    </div>
  </aside>
</main>
<script>
let weights = { prosperity: 0.45, democracy: 0.10, scienceTech: 0.35, space: 0.10 };
(async function(){
  const res = await fetch('data.json');
  const data = await res.json();
  if (data.weights) weights = {...data.weights};
  const people = data.people;

  const fmt = x => (Math.round(x*10)/10).toFixed(1);
  const tbody = document.querySelector('#hii tbody');
  const count = document.querySelector('#count');
  const search = document.querySelector('#search');

  function H(s, w) {
    return s.prosperity*w.prosperity + s.democracy*w.democracy + s.scienceTech*w.scienceTech + s.space*w.space;
  }

  let rows = people.map(p => {
    const H_dom = H(p.scores.domestic, weights);
    const H_world = H(p.scores.world, weights);
    return {...p, H_dom, H_world};
  });

  let sortKey = 'H_world', sortDir = -1;

  function render() {
    rows = people.map(p => {
      const H_dom = H(p.scores.domestic, weights);
      const H_world = H(p.scores.world, weights);
      return {...p, H_dom, H_world};
    });
    const q = search.value.trim().toLowerCase();
    let data;
    if (q.includes(',')) {
      const terms = q.split(',').map(s => s.trim()).filter(Boolean);
      data = rows.filter(r => terms.some(term => (r.name + ' ' + r.country).toLowerCase().includes(term)));
    } else {
      data = rows.filter(r => (r.name + ' ' + r.country).toLowerCase().includes(q));
    }
    data.sort((a,b)=>{
      const ka = key(a, sortKey), kb = key(b, sortKey);
      if (ka < kb) return -1*sortDir;
      if (ka > kb) return  1*sortDir;
      return 0;
    });
    function getFlag(country) {
      if (!country) return '';
      const map = {
        'united states': 'ğŸ‡ºğŸ‡¸', 'usa': 'ğŸ‡ºğŸ‡¸', 'us': 'ğŸ‡ºğŸ‡¸',
        'russia': 'ğŸ‡·ğŸ‡º', 'ru': 'ğŸ‡·ğŸ‡º',
        'cuba / latin america': 'ğŸ‡¨ğŸ‡º', 'cuba': 'ğŸ‡¨ğŸ‡º', 'cu': 'ğŸ‡¨ğŸ‡º',
        'israel': 'ğŸ‡®ğŸ‡±', 'il': 'ğŸ‡®ğŸ‡±',
        'china': 'ğŸ‡¨ğŸ‡³', 'cn': 'ğŸ‡¨ğŸ‡³',
        'india': 'ğŸ‡®ğŸ‡³', 'in': 'ğŸ‡®ğŸ‡³',
        'united kingdom': 'ğŸ‡¬ğŸ‡§', 'uk': 'ğŸ‡¬ğŸ‡§', 'gb': 'ğŸ‡¬ğŸ‡§',
        'france': 'ğŸ‡«ğŸ‡·', 'fr': 'ğŸ‡«ğŸ‡·',
        'germany': 'ğŸ‡©ğŸ‡ª', 'de': 'ğŸ‡©ğŸ‡ª',
        'japan': 'ğŸ‡¯ğŸ‡µ', 'jp': 'ğŸ‡¯ğŸ‡µ',
        'canada': 'ğŸ‡¨ğŸ‡¦', 'ca': 'ğŸ‡¨ğŸ‡¦',
        'brazil': 'ğŸ‡§ğŸ‡·', 'br': 'ğŸ‡§ğŸ‡·',
        'south africa': 'ğŸ‡¿ğŸ‡¦', 'za': 'ğŸ‡¿ğŸ‡¦',
        'european union': 'ğŸ‡ªğŸ‡º', 'eu': 'ğŸ‡ªğŸ‡º',
        'turkey': 'ğŸ‡¹ğŸ‡·', 'tr': 'ğŸ‡¹ğŸ‡·',
        'australia': 'ğŸ‡¦ğŸ‡º', 'au': 'ğŸ‡¦ğŸ‡º',
        'latin america': 'ğŸŒ',
      };
      const c = country.trim().toLowerCase();
      if (map[c]) return map[c];
      for (const k in map) {
        if (c.includes(k)) return map[k];
      }
      return 'ğŸŒ';
    }
    tbody.innerHTML = data.map(r => `
      <tr data-id="${r.id}">
  <td>${getFlag(r.country)} ${r.name}</td>
  <td class="hi">${fmt(r.H_dom)} <span class="spark"><i style="width:${Math.min(100, (r.H_dom+40)/125*100)}%;background:${r.H_dom>=0?'var(--green)':'var(--red)'}"></i></span></td>
        <td>${r.scores.domestic.prosperity}</td>
        <td>${r.scores.domestic.democracy}</td>
        <td>${r.scores.domestic.scienceTech}</td>
        <td>${r.scores.domestic.space}</td>
  <td class="hi">${fmt(r.H_world)} <span class="spark"><i style="width:${Math.min(100, (r.H_world+40)/125*100)}%;background:${r.H_world>=0?'var(--green)':'var(--red)'}"></i></span></td>
        <td>${r.scores.world.prosperity}</td>
        <td>${r.scores.world.democracy}</td>
        <td>${r.scores.world.scienceTech}</td>
        <td>${r.scores.world.space}</td>
      </tr>`).join('');
    count.textContent = data.length + ' people';
  }

  function key(obj, k){
    switch(k){
      case 'name': return obj.name.toLowerCase();
      case 'country': return obj.country.toLowerCase();
      case 'P_dom': return obj.scores.domestic.prosperity;
      case 'P_world': return obj.scores.world.prosperity;
      case 'D_dom': return obj.scores.domestic.democracy;
      case 'D_world': return obj.scores.world.democracy;
      case 'S_dom': return obj.scores.domestic.scienceTech;
      case 'S_world': return obj.scores.world.scienceTech;
      case 'Sp_dom': return obj.scores.domestic.space;
      case 'Sp_world': return obj.scores.world.space;
      case 'H_dom': return obj.H_dom;
      case 'H_world': return obj.H_world;
      default: return obj.H_world;
    }
  }

  document.querySelectorAll('th').forEach(th => {
    th.addEventListener('click', () => {
      const k = th.dataset.k;
      if (sortKey === k) sortDir *= -1;
      else { sortKey = k; sortDir = (k.includes('H_') ? -1 : 1); }
      render();
    });
  });

  tbody.addEventListener('click', (e)=>{
    const tr = e.target.closest('tr'); if(!tr) return;
    const id = tr.getAttribute('data-id');
    const p = rows.find(x => x.id === id);
    if (!p) return;
    function getFlag(country) {
      if (!country) return '';
      const map = {
        'united states': 'ğŸ‡ºğŸ‡¸', 'usa': 'ğŸ‡ºğŸ‡¸', 'us': 'ğŸ‡ºğŸ‡¸',
        'russia': 'ğŸ‡·ğŸ‡º', 'ru': 'ğŸ‡·ğŸ‡º',
        'cuba / latin america': 'ğŸ‡¨ğŸ‡º', 'cuba': 'ğŸ‡¨ğŸ‡º', 'cu': 'ğŸ‡¨ğŸ‡º',
        'israel': 'ğŸ‡®ğŸ‡±', 'il': 'ğŸ‡®ğŸ‡±',
        'china': 'ğŸ‡¨ğŸ‡³', 'cn': 'ğŸ‡¨ğŸ‡³',
        'india': 'ğŸ‡®ğŸ‡³', 'in': 'ğŸ‡®ğŸ‡³',
        'united kingdom': 'ğŸ‡¬ğŸ‡§', 'uk': 'ğŸ‡¬ğŸ‡§', 'gb': 'ğŸ‡¬ğŸ‡§',
        'france': 'ğŸ‡«ğŸ‡·', 'fr': 'ğŸ‡«ğŸ‡·',
        'germany': 'ğŸ‡©ğŸ‡ª', 'de': 'ğŸ‡©ğŸ‡ª',
        'japan': 'ğŸ‡¯ğŸ‡µ', 'jp': 'ğŸ‡¯ğŸ‡µ',
        'canada': 'ğŸ‡¨ğŸ‡¦', 'ca': 'ğŸ‡¨ğŸ‡¦',
        'brazil': 'ğŸ‡§ğŸ‡·', 'br': 'ğŸ‡§ğŸ‡·',
        'south africa': 'ğŸ‡¿ğŸ‡¦', 'za': 'ğŸ‡¿ğŸ‡¦',
        'european union': 'ğŸ‡ªğŸ‡º', 'eu': 'ğŸ‡ªğŸ‡º',
        'turkey': 'ğŸ‡¹ğŸ‡·', 'tr': 'ğŸ‡¹ğŸ‡·',
        'australia': 'ğŸ‡¦ğŸ‡º', 'au': 'ğŸ‡¦ğŸ‡º',
        'latin america': 'ğŸŒ',
      };
      const c = country.trim().toLowerCase();
      if (map[c]) return map[c];
      for (const k in map) {
        if (c.includes(k)) return map[k];
      }
      return 'ğŸŒ';
    }
    document.querySelector('#drawer h2').innerHTML = getFlag(p.country) + ' ' + p.name;
    document.querySelector('#who').textContent = p.country + ' â€¢ Domestic HII ' + fmt(p.H_dom) + ' â€¢ World HII ' + fmt(p.H_world);
    function explainText(val) {
      if (typeof val === 'string') return val;
      if (val && typeof val === 'object') {
        return `<b>Domestic:</b> ${val.domestic || ''}<br><b>World:</b> ${val.world || ''}`;
      }
      return '';
    }
    document.querySelector('#xP').innerHTML  = explainText(p.explain.prosperity);
    document.querySelector('#xD').innerHTML  = explainText(p.explain.democracy);
    document.querySelector('#xS').innerHTML  = explainText(p.explain.scienceTech);
    document.querySelector('#xSp').innerHTML = explainText(p.explain.space);
    document.querySelector('#details').style.display = 'block';
    document.getElementById('drawer').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  document.getElementById('closeDrawer').addEventListener('click', function() {
    document.querySelector('#drawer h2').textContent = 'Select a person';
    document.querySelector('#who').textContent = '';
    document.querySelector('#xP').textContent = '';
    document.querySelector('#xD').textContent = '';
    document.querySelector('#xS').textContent = '';
    document.querySelector('#xSp').textContent = '';
    document.getElementById('details').style.display = 'none';
  });

  search.addEventListener('input', render);

  // Weights UI logic
  function updateWeights() {
    const wP = parseFloat(document.getElementById('wP').value);
    const wD = parseFloat(document.getElementById('wD').value);
    const wS = parseFloat(document.getElementById('wS').value);
    const wSp = parseFloat(document.getElementById('wSp').value);
    const sum = wP + wD + wS + wSp;
    if (Math.abs(sum - 1) > 0.01) {
      document.getElementById('weights-warning').style.display = '';
      return;
    } else {
      document.getElementById('weights-warning').style.display = 'none';
    }
    weights = { prosperity: wP, democracy: wD, scienceTech: wS, space: wSp };
    // Find largest weight and set sortKey to its world column
    const weightMap = [
      { key: 'P_world', value: wP },
      { key: 'D_world', value: wD },
      { key: 'S_world', value: wS },
      { key: 'Sp_world', value: wSp }
    ];
    weightMap.sort((a, b) => b.value - a.value);
    sortKey = weightMap[0].key;
    sortDir = -1;
    render();
  }
  document.getElementById('wP').addEventListener('input', updateWeights);
  document.getElementById('wD').addEventListener('input', updateWeights);
  document.getElementById('wS').addEventListener('input', updateWeights);
  document.getElementById('wSp').addEventListener('input', updateWeights);

  // Initialize weights UI with loaded weights
  document.getElementById('wP').value = weights.prosperity;
  document.getElementById('wD').value = weights.democracy;
  document.getElementById('wS').value = weights.scienceTech;
  document.getElementById('wSp').value = weights.space;

  render();
})();
</script>
</script>
<footer style="text-align:center; margin-top:40px; font-size:0.9em; color:#777;">
  Â© 2025 Stas Holodnak. All rights reserved.<br>
  Holodnak Impact Indexâ„¢ (HII)
</footer>
</body>
</html>
