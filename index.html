<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Holodnak Impact Index (v17)</title>
<style>
  :root { --bg:#0b0d10; --fg:#eaeef2; --muted:#9aa4af; --accent:#7cc4ff; --card:#12161b; --green:#27c93f; --red:#ff5555; }
  html, body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; }
  header { padding: 20px; border-bottom: 1px solid #1e242b; }
  header h1 { margin: 0 0 6px 0; font-size: 22px; }
  header .meta { color: var(--muted); font-size: 13px; }
  main { display: grid; grid-template-columns: 1fr 360px; gap: 18px; padding: 18px; }
  @media (max-width: 980px) { main { grid-template-columns: 1fr; } #drawer { order: -1; } }
  #toolbar { display:flex; gap:10px; align-items: center; margin-bottom: 10px; }
  #search { flex:1; padding:10px 12px; border-radius: 8px; border:1px solid #27303a; background:#0f1318; color:var(--fg); }
  table { width: 100%; border-collapse: collapse; }
  th, td { padding: 10px 8px; border-bottom: 1px solid #1e242b; text-align: right; font-variant-numeric: tabular-nums; }
  th:first-child, td:first-child, th:nth-child(2), td:nth-child(2) { text-align: left; }
  /* Removed sticky/frozen first column styles */
  th { position: sticky; top: 0; background: #0f1318; cursor: pointer; white-space: nowrap; }
  tr:hover { background: #0f1318; }
  .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#0f1318; border:1px solid #27303a; color:var(--muted); }
  .spark { display:inline-block; height:8px; width:100px; background:#1e242b; border-radius:4px; vertical-align:middle; margin-left:6px; }
  .spark > i { display:block; height:8px; border-radius:4px; background:linear-gradient(90deg, var(--red), var(--green)); }
  #drawer { background: var(--card); border:1px solid #1e242b; border-radius: 12px; padding: 14px; height: fit-content; position: sticky; top: 18px; }
  #drawer h2 { margin: 4px 0 12px 0; font-size: 18px; }
  #drawer .dim { margin: 8px 0 14px; }
  #drawer .dim h3 { margin: 0 0 6px; font-size: 14px; color: var(--muted); }
  #drawer .dim p { margin: 0; font-size: 14px; line-height: 1.35; color: #c9d2db; }
  .muted { color: var(--muted); font-size: 13px; }
  .hi { font-weight:600; }
  .foot { color: var(--muted); margin-top: 8px; font-size: 12px; }
  .sliders { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0; padding: 16px; background: var(--card); border: 1px solid #1e242b; border-radius: 8px; }
  .slider-item { display: flex; flex-direction: column; gap: 6px; }
  .slider-item label { font-size: 13px; color: var(--muted); display: flex; justify-content: space-between; align-items: center; }
  .slider-item label .weight-value { color: var(--accent); font-weight: 600; }
  .slider-item input[type="range"] { width: 100%; height: 6px; background: #1e242b; border-radius: 3px; outline: none; -webkit-appearance: none; appearance: none; }
  .slider-item input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: var(--accent); border-radius: 50%; cursor: pointer; }
  .slider-item input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; background: var(--accent); border-radius: 50%; cursor: pointer; border: none; }
</style>
</head>
<body>
<header>
  <h1>Holodnak Impact Index (v17)</h1>
  <p class="tagline">
    Measuring human influence on prosperity, democracy, science, and space.
  </p>
  <div class="meta" id="weightDisplay">Weights: Prosperity 0.45 Â· Democracy 0.10 Â· Science & Tech 0.35 Â· Space 0.10</div>
  <div class="sliders">
    <div class="slider-item">
      <label>
        <span>Prosperity</span>
        <span class="weight-value" id="weight-prosperity">0.45</span>
      </label>
      <input type="range" id="slider-prosperity" min="0" max="100" value="45" step="1">
    </div>
    <div class="slider-item">
      <label>
        <span>Democracy</span>
        <span class="weight-value" id="weight-democracy">0.10</span>
      </label>
      <input type="range" id="slider-democracy" min="0" max="100" value="10" step="1">
    </div>
    <div class="slider-item">
      <label>
        <span>Science & Tech</span>
        <span class="weight-value" id="weight-scienceTech">0.35</span>
      </label>
      <input type="range" id="slider-scienceTech" min="0" max="100" value="35" step="1">
    </div>
    <div class="slider-item">
      <label>
        <span>Space</span>
        <span class="weight-value" id="weight-space">0.10</span>
      </label>
      <input type="range" id="slider-space" min="0" max="100" value="10" step="1">
    </div>
  </div>
</header>
<main>
  <section>
    <div id="toolbar">
  <input id="search" type="search" placeholder="Search people or countriesâ€¦ (comma to compare)" aria-label="Search" title="Type multiple names or countries separated by commas to compare (e.g., Elon Musk, Karl Marx)">
      <span class="pill" id="count"></span>
    </div>
  <div style="overflow:auto; max-height:60vh; padding-right:18px;">
      <table id="hii">
        <thead>
          <tr>
            <th data-k="name">Person</th>
            <th data-k="H_dom">HII-Domestic</th>
            <th data-k="P_dom">Prosperity</th>
            <th data-k="D_dom">Democracy</th>
            <th data-k="S_dom">Science & Tech</th>
            <th data-k="Sp_dom">Space</th>
            <th data-k="H_world">HII-World</th>
            <th data-k="P_world">Prosperity</th>
            <th data-k="D_world">Democracy</th>
            <th data-k="S_world">Science & Tech</th>
            <th data-k="Sp_world">Space</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="foot">Click headers to sort. Click a row to see the rationale.</div>
    <div style="margin:24px 0 0 0; text-align:center;">
      <span style="font-size:15px; color:var(--muted);">Suggest a person to evaluate:</span>
      <span style="margin-left:8px; font-size:15px;">
        <a href="https://github.com/bayridgeboy/holodnak-impact-index/issues/new" target="_blank" style="color:var(--accent);text-decoration:underline;">Create an issue on GitHub</a>
      </span>
    </div>
  </section>
  <aside id="drawer" style="position:relative;">
    <button id="closeDrawer" title="Close" style="position:absolute;top:8px;right:8px;background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;line-height:1;">&times;</button>
    <h2>Select a person</h2>
    <div class="muted">Click any row to see the per-variable rationale.</div>
    <div id="details" style="display:none;">
      <div class="muted" id="who"></div>
      <div class="dim"><h3>Prosperity</h3><p id="xP"></p></div>
      <div class="dim"><h3>Democracy</h3><p id="xD"></p></div>
      <div class="dim"><h3>Science & Tech</h3><p id="xS"></p></div>
      <div class="dim"><h3>Space</h3><p id="xSp"></p></div>
    </div>
  </aside>
</main>
<script>
(async function(){
  const res = await fetch('data.json');
  const {weights: defaultWeights, people} = await res.json();

  // Initialize current weights from default
  let weights = {...defaultWeights};

  const H = (s, w) => (s.prosperity*w.prosperity + s.democracy*w.democracy + s.scienceTech*w.scienceTech + s.space*w.space);
  const fmt = x => (Math.round(x*10)/10).toFixed(1);
  const tbody = document.querySelector('#hii tbody');
  const count = document.querySelector('#count');
  const search = document.querySelector('#search');

  let rows = [];

  function recalculateScores() {
    rows = people.map(p => {
      const H_dom = H(p.scores.domestic, weights);
      const H_world = H(p.scores.world, weights);
      return {...p, H_dom, H_world};
    });
  }

  // Initial calculation
  recalculateScores();

  let sortKey = 'H_world', sortDir = -1;

  function render() {
    const q = search.value.trim().toLowerCase();
    let data;
    if (q.includes(',')) {
      // Multi-name search: split by comma, trim, filter if any match
      const terms = q.split(',').map(s => s.trim()).filter(Boolean);
      data = rows.filter(r => terms.some(term => (r.name + ' ' + r.country).toLowerCase().includes(term)));
    } else {
      data = rows.filter(r => (r.name + ' ' + r.country).toLowerCase().includes(q));
    }
    data.sort((a,b)=>{
      const ka = key(a, sortKey), kb = key(b, sortKey);
      if (ka < kb) return -1*sortDir;
      if (ka > kb) return  1*sortDir;
      return 0;
    });
    function getFlag(country) {
      if (!country) return '';
      const map = {
        'united states': 'ðŸ‡ºðŸ‡¸', 'usa': 'ðŸ‡ºðŸ‡¸', 'us': 'ðŸ‡ºðŸ‡¸',
        'russia': 'ðŸ‡·ðŸ‡º', 'ru': 'ðŸ‡·ðŸ‡º',
        'cuba / latin america': 'ðŸ‡¨ðŸ‡º', 'cuba': 'ðŸ‡¨ðŸ‡º', 'cu': 'ðŸ‡¨ðŸ‡º',
        'israel': 'ðŸ‡®ðŸ‡±', 'il': 'ðŸ‡®ðŸ‡±',
        'china': 'ðŸ‡¨ðŸ‡³', 'cn': 'ðŸ‡¨ðŸ‡³',
        'india': 'ðŸ‡®ðŸ‡³', 'in': 'ðŸ‡®ðŸ‡³',
        'united kingdom': 'ðŸ‡¬ðŸ‡§', 'uk': 'ðŸ‡¬ðŸ‡§', 'gb': 'ðŸ‡¬ðŸ‡§',
        'france': 'ðŸ‡«ðŸ‡·', 'fr': 'ðŸ‡«ðŸ‡·',
        'germany': 'ðŸ‡©ðŸ‡ª', 'de': 'ðŸ‡©ðŸ‡ª',
        'japan': 'ðŸ‡¯ðŸ‡µ', 'jp': 'ðŸ‡¯ðŸ‡µ',
        'canada': 'ðŸ‡¨ðŸ‡¦', 'ca': 'ðŸ‡¨ðŸ‡¦',
        'brazil': 'ðŸ‡§ðŸ‡·', 'br': 'ðŸ‡§ðŸ‡·',
        'south africa': 'ðŸ‡¿ðŸ‡¦', 'za': 'ðŸ‡¿ðŸ‡¦',
        'european union': 'ðŸ‡ªðŸ‡º', 'eu': 'ðŸ‡ªðŸ‡º',
        'turkey': 'ðŸ‡¹ðŸ‡·', 'tr': 'ðŸ‡¹ðŸ‡·',
        'australia': 'ðŸ‡¦ðŸ‡º', 'au': 'ðŸ‡¦ðŸ‡º',
        'latin america': 'ðŸŒŽ',
      };
      const c = country.trim().toLowerCase();
      // Exact match first
      if (map[c]) return map[c];
      // Partial match
      for (const k in map) {
        if (c.includes(k)) return map[k];
      }
      return 'ðŸŒ';
    }
    tbody.innerHTML = data.map(r => `
      <tr data-id="${r.id}">
  <td>${getFlag(r.country)} ${r.name}</td>
  <td class="hi">${fmt(r.H_dom)} <span class="spark"><i style="width:${Math.min(100, (r.H_dom+40)/125*100)}%;background:${r.H_dom>=0?'var(--green)':'var(--red)'}"></i></span></td>
        <td>${r.scores.domestic.prosperity}</td>
        <td>${r.scores.domestic.democracy}</td>
        <td>${r.scores.domestic.scienceTech}</td>
        <td>${r.scores.domestic.space}</td>
  <td class="hi">${fmt(r.H_world)} <span class="spark"><i style="width:${Math.min(100, (r.H_world+40)/125*100)}%;background:${r.H_world>=0?'var(--green)':'var(--red)'}"></i></span></td>
        <td>${r.scores.world.prosperity}</td>
        <td>${r.scores.world.democracy}</td>
        <td>${r.scores.world.scienceTech}</td>
        <td>${r.scores.world.space}</td>
      </tr>`).join('');
    count.textContent = data.length + ' people';
  }

  function key(obj, k){
    switch(k){
      case 'name': return obj.name.toLowerCase();
      case 'country': return obj.country.toLowerCase();
      case 'P_dom': return obj.scores.domestic.prosperity;
      case 'P_world': return obj.scores.world.prosperity;
      case 'D_dom': return obj.scores.domestic.democracy;
      case 'D_world': return obj.scores.world.democracy;
      case 'S_dom': return obj.scores.domestic.scienceTech;
      case 'S_world': return obj.scores.world.scienceTech;
      case 'Sp_dom': return obj.scores.domestic.space;
      case 'Sp_world': return obj.scores.world.space;
      case 'H_dom': return obj.H_dom;
      case 'H_world': return obj.H_world;
      default: return obj.H_world;
    }
  }

  // sorting
  document.querySelectorAll('th').forEach(th => {
    th.addEventListener('click', () => {
      const k = th.dataset.k;
      if (sortKey === k) sortDir *= -1;
      else { sortKey = k; sortDir = (k.includes('H_') ? -1 : 1); }
      render();
    });
  });


  // details drawer
  tbody.addEventListener('click', (e)=>{
    const tr = e.target.closest('tr'); if(!tr) return;
    const id = tr.getAttribute('data-id');
    const p = rows.find(x => x.id === id);
    if (!p) return;
    document.querySelector('#drawer h2').textContent = p.name;
    document.querySelector('#who').textContent = p.country + ' â€¢ Domestic HII ' + fmt(p.H_dom) + ' â€¢ World HII ' + fmt(p.H_world);
    document.querySelector('#xP').textContent  = p.explain.prosperity;
    document.querySelector('#xD').textContent  = p.explain.democracy;
    document.querySelector('#xS').textContent  = p.explain.scienceTech;
    document.querySelector('#xSp').textContent = p.explain.space;
  document.querySelector('#details').style.display = 'block';
  // Scroll sidebar into view for mobile usability
  document.getElementById('drawer').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  // close drawer button
  document.getElementById('closeDrawer').addEventListener('click', function() {
    document.querySelector('#drawer h2').textContent = 'Select a person';
    document.querySelector('#who').textContent = '';
    document.querySelector('#xP').textContent = '';
    document.querySelector('#xD').textContent = '';
    document.querySelector('#xS').textContent = '';
    document.querySelector('#xSp').textContent = '';
    document.getElementById('details').style.display = 'none';
  });

  search.addEventListener('input', render);

  // Slider event handlers
  function updateWeights() {
    const prosperityVal = parseInt(document.getElementById('slider-prosperity').value);
    const democracyVal = parseInt(document.getElementById('slider-democracy').value);
    const scienceTechVal = parseInt(document.getElementById('slider-scienceTech').value);
    const spaceVal = parseInt(document.getElementById('slider-space').value);
    
    // Convert to decimal (0-1 range)
    weights.prosperity = prosperityVal / 100;
    weights.democracy = democracyVal / 100;
    weights.scienceTech = scienceTechVal / 100;
    weights.space = spaceVal / 100;
    
    // Update display values
    document.getElementById('weight-prosperity').textContent = weights.prosperity.toFixed(2);
    document.getElementById('weight-democracy').textContent = weights.democracy.toFixed(2);
    document.getElementById('weight-scienceTech').textContent = weights.scienceTech.toFixed(2);
    document.getElementById('weight-space').textContent = weights.space.toFixed(2);
    
    // Update the meta display
    document.getElementById('weightDisplay').textContent = 
      `Weights: Prosperity ${weights.prosperity.toFixed(2)} Â· Democracy ${weights.democracy.toFixed(2)} Â· Science & Tech ${weights.scienceTech.toFixed(2)} Â· Space ${weights.space.toFixed(2)}`;
    
    // Recalculate scores and re-render
    recalculateScores();
    render();
  }

  // Attach event listeners to all sliders
  document.getElementById('slider-prosperity').addEventListener('input', updateWeights);
  document.getElementById('slider-democracy').addEventListener('input', updateWeights);
  document.getElementById('slider-scienceTech').addEventListener('input', updateWeights);
  document.getElementById('slider-space').addEventListener('input', updateWeights);

  render();
})();
</script>
</script>
<footer style="text-align:center; margin-top:40px; font-size:0.9em; color:#777;">
  Â© 2025 Stas Holodnak. All rights reserved.<br>
  Holodnak Impact Indexâ„¢ (HII)
</footer>
</body>
</html>
